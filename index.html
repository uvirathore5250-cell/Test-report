<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tanita AI Auto-Scanner Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/tesseract.js@v2.1.0/dist/tesseract.min.js"></script>
    <style>
        @media print { .no-print { display: none; } .print-area { display: block !important; } }
        .input-box { border: 2px solid #e2e8f0; border-radius: 12px; padding: 12px; font-weight: 800; width: 100%; outline: none; transition: 0.3s; }
        .input-box:focus { border-color: #000; background-color: #f8fafc; }
        .scan-active { background: #2563eb !important; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
    </style>
</head>
<body class="bg-gray-100 p-2 md:p-6 font-sans">

    <div class="max-w-7xl mx-auto no-print">
        <header class="text-center mb-6">
            <h1 class="text-4xl font-black uppercase italic tracking-tighter">Tanita AI Scanner Pro</h1>
            <p class="text-gray-500 font-bold uppercase text-[10px]">Full Body Composition Analysis</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            <div class="lg:col-span-5 bg-white p-6 rounded-[2.5rem] shadow-2xl border-2 border-black">
                <div class="flex justify-between items-center mb-4">
                    <span class="bg-black text-white px-3 py-1 rounded-full font-black text-[10px]">STEP 1: UPLOAD SLIP</span>
                </div>
                
                <input type="file" accept="image/*" id="bmi_file" onchange="processPreview(event)" class="w-full mb-4 text-xs font-bold file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:bg-black file:text-white cursor-pointer">
                
                <div class="bg-gray-50 rounded-3xl h-[500px] flex items-center justify-center overflow-hidden border-2 border-dashed border-gray-300 mb-4 relative">
                    <img id="slip_img" class="hidden w-full h-full object-contain p-2">
                    <p id="placeholder_text" class="text-gray-400 font-black text-xs uppercase text-center p-10">Choose slip photo to begin</p>
                </div>

                <button id="scan_trigger" onclick="runAIScan()" class="w-full bg-gray-400 text-white py-5 rounded-2xl font-black text-xl uppercase tracking-widest transition-all">
                    Start Auto-Scan
                </button>
            </div>

            <div class="lg:col-span-7 bg-white p-8 rounded-[2.5rem] shadow-2xl border-t-[15px] border-black">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="md:col-span-2">
                        <label class="text-[10px] font-black uppercase text-gray-400">Client Name</label>
                        <input type="text" id="in_name" class="input-box bg-yellow-50 text-xl" placeholder="NAME">
                    </div>

                    <div class="space-y-3 bg-blue-50 p-5 rounded-3xl border border-blue-100">
                        <h3 class="font-black text-blue-900 text-xs uppercase border-b border-blue-200 pb-1 mb-2">Composition Stats</h3>
                        <div><label class="text-[9px] font-bold text-gray-400">WEIGHT (kg)</label><input type="text" id="in_w" class="input-box"></div>
                        <div><label class="text-[9px] font-bold text-gray-400">FAT %</label><input type="text" id="in_fat" class="input-box"></div>
                        <div><label class="text-[9px] font-bold text-gray-400">MUSCLE MASS (kg)</label><input type="text" id="in_mus" class="input-box"></div>
                        <div><label class="text-[9px] font-bold text-gray-400">TBW % (Water)</label><input type="text" id="in_wat" class="input-box"></div>
                    </div>

                    <div class="space-y-3 bg-purple-50 p-5 rounded-3xl border border-purple-100">
                        <h3 class="font-black text-purple-900 text-xs uppercase border-b border-purple-200 pb-1 mb-2">Tanita Specials</h3>
                        <div><label class="text-[9px] font-bold text-gray-400">BMI</label><input type="text" id="in_bmi" class="input-box"></div>
                        <div><label class="text-[9px] font-bold text-gray-400">VISCERAL FAT RATING</label><input type="text" id="in_visc" class="input-box"></div>
                        <div><label class="text-[9px] font-bold text-gray-400">BMR (kcal)</label><input type="text" id="in_bmr" class="input-box"></div>
                        <div><label class="text-[9px] font-bold text-gray-400">BONE MASS (kg)</label><input type="text" id="in_bone" class="input-box"></div>
                        <div><label class="text-[9px] font-bold text-gray-400">METABOLIC AGE</label><input type="text" id="in_age" class="input-box"></div>
                    </div>

                    <div class="md:col-span-2 grid grid-cols-2 md:grid-cols-4 gap-4 bg-green-50 p-5 rounded-3xl border border-green-100 mt-2">
                        <h3 class="col-span-full font-black text-green-900 text-xs uppercase border-b border-green-200 pb-1">Gym Tests</h3>
                        <input type="text" id="in_plank" placeholder="Plank (s)" class="input-box text-xs">
                        <input type="text" id="in_bicep" placeholder="Biceps" class="input-box text-xs">
                        <input type="text" id="in_cardio" placeholder="Cardio" class="input-box text-xs">
                        <input type="text" id="in_med" placeholder="Medical" class="input-box text-xs bg-red-50">
                    </div>
                </div>

                <button onclick="generateFinalReport()" class="w-full mt-8 bg-black text-white py-5 rounded-2xl font-black text-2xl hover:scale-[1.01] transition-all uppercase italic shadow-2xl">Create Final Report</button>
            </div>
        </div>
    </div>

    <div id="printReport" class="hidden bg-white max-w-4xl mx-auto p-12 shadow-2xl border-x-[20px] border-black my-10 print-area">
        <h1 class="text-5xl font-black italic border-b-8 border-black pb-4 mb-8">FITNESS ASSESSMENT</h1>
        <div class="flex justify-between mb-12">
            <div>
                <h2 id="out_name" class="text-4xl font-black uppercase tracking-tighter"></h2>
                <p class="text-gray-400 font-bold uppercase italic" id="out_date"></p>
            </div>
            <div class="text-right font-black uppercase text-sm border-l-4 border-black pl-4">
                Certified Report<br>Tanita Analysis
            </div>
        </div>

        <div class="grid grid-cols-2 gap-12 border-b-4 border-gray-100 pb-12 mb-8">
            <div id="out_stats" class="space-y-2 font-black text-sm uppercase text-gray-800"></div>
            <div class="bg-gray-50 p-8 rounded-3xl shadow-inner border-l-[15px] border-blue-600">
                <h3 class="font-black text-xs underline mb-4 uppercase italic text-blue-900">Expert AI Analysis</h3>
                <div id="out_ai" class="text-[12px] font-bold text-gray-700 space-y-4 leading-relaxed italic"></div>
            </div>
        </div>

        <button onclick="window.print()" class="no-print w-full bg-black text-white py-4 rounded-xl font-black uppercase text-sm tracking-widest">Download PDF Report</button>
    </div>

    <script>
        let myFile;

        function processPreview(e) {
            myFile = e.target.files[0];
            if (myFile) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    document.getElementById('slip_img').src = event.target.result;
                    document.getElementById('slip_img').classList.remove('hidden');
                    document.getElementById('placeholder_text').classList.add('hidden');
                    document.getElementById('scan_trigger').classList.add('scan-active');
                    document.getElementById('scan_trigger').innerText = "Ready to Scan";
                };
                reader.readAsDataURL(myFile);
            }
        }

        async function runAIScan() {
            if(!myFile) return alert("Pehle photo upload karein!");
            
            const btn = document.getElementById('scan_trigger');
            btn.innerText = "AI Processing Slip...";
            btn.classList.add('scan-active');

            try {
                const { data: { text } } = await Tesseract.recognize(myFile, 'eng');
                console.log("Raw Text Scanned:", text);

                const extract = (reg) => {
                    const m = text.match(reg);
                    return m ? m[1] : '';
                };

                // Tanita SC-330 specific logic
                document.getElementById('in_w').value = extract(/WEIGHT\s*(\d+\.\d+)/i) || extract(/(\d+\.\d+)\s*kg/i);
                document.getElementById('in_fat').value = extract(/FAT\s*%\s*(\d+\.\d+)/i) || extract(/FAT\s*(\d+\.\d+)/i);
                document.getElementById('in_mus').value = extract(/MUSCLE\s*MASS\s*(\d+\.\d+)/i) || extract(/MUSCLE\s*(\d+\.\d+)/i);
                document.getElementById('in_wat').value = extract(/TBW\s*%\s*(\d+\.\d+)/i) || extract(/WATER\s*(\d+\.\d+)/i);
                document.getElementById('in_bmi').value = extract(/BMI\s*(\d+\.\d+)/i);
                document.getElementById('in_visc').value = extract(/VISCERAL\s*FAT\s*RATING\s*(\d+)/i) || extract(/VISCERAL\s*(\d+)/i);
                document.getElementById('in_bmr').value = extract(/BMR\s*(\d+)\s*kcal/i) || extract(/BMR\s*(\d+)/i);
                document.getElementById('in_bone').value = extract(/BONE\s*MASS\s*(\d+\.\d+)/i) || extract(/BONE\s*(\d+\.\d+)/i);
                document.getElementById('in_age').value = extract(/METABOLIC\s*AGE\s*(\d+)/i) || extract(/AGE\s*(\d+)/i);

                alert("Scan Complete! Sab parameters fill ho gaye hain.");
            } catch (err) {
                alert("Scan failed. Photo ki clarity check karein.");
            } finally {
                btn.innerText = "Scan Again";
                btn.classList.remove('scan-active');
            }
        }

        function generateFinalReport() {
            const name = document.getElementById('in_name').value;
            const water = parseFloat(document.getElementById('in_wat').value) || 0;
            const mus = parseFloat(document.getElementById('in_mus').value) || 0;
            const med = document.getElementById('in_med').value.toLowerCase();

            if(!name) return alert("Client Name bharein!");

            document.getElementById('out_name').innerText = name;
            document.getElementById('out_date').innerText = new Date().toLocaleDateString();

            document.getElementById('out_stats').innerHTML = `
                <div class="flex justify-between border-b py-1 text-blue-900"><span>Weight:</span><span>${document.getElementById('in_w').value} kg</span></div>
                <div class="flex justify-between border-b py-1"><span>BMI:</span><span>${document.getElementById('in_bmi').value}</span></div>
                <div class="flex justify-between border-b py-1"><span>Fat %:</span><span>${document.getElementById('in_fat').value}%</span></div>
                <div class="flex justify-between border-b py-1"><span>Muscle Mass:</span><span>${mus} kg</span></div>
                <div class="flex justify-between border-b py-1"><span>Visceral Fat:</span><span>${document.getElementById('in_visc').value}</span></div>
                <div class="flex justify-between border-b py-1"><span>Metabolic Age:</span><span>${document.getElementById('in_age').value} Yrs</span></div>
                <div class="flex justify-between border-b py-1"><span>Bone Mass:</span><span>${document.getElementById('in_bone').value} kg</span></div>
            `;

            // Logic matching Nandini Mam's profile
            let aiText = `<p>‚úÖ <b>Muscle Health:</b> Muscle weight is ${mus > 30 ? [span_0](start_span)[span_1](start_span)'perfect for your profile' : 'stable but needs protein support'}.[span_0](end_span)[span_1](end_span)</p>`;
            
            if(water < 50) {
                aiText += `<p>‚ö†Ô∏è <b>Water Level:</b> Currently ${water}% (Low). [span_2](start_span)Ideal level should be >50% for metabolic health.[span_2](end_span)</p>`;
            }

            if(med.includes("bp") || med.includes("hyper")) {
                aiText += `<p>üõë <b>Medical Precaution:</b> Hypertension detected. [span_3](start_span)Avoid very high-intensity workouts; monitor BP before sessions.[span_3](end_span)</p>`;
            }

            [span_4](start_span)[span_5](start_span)aiText += `<p>ü•ó <b>Recommendation:</b> Increase protein intake to support skeletal muscle maintenance.[span_4](end_span)[span_5](end_span)</p>`;

            document.getElementById('out_ai').innerHTML = aiText;
            document.getElementById('printReport').classList.remove('hidden');
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        }
    </script>
</body>
</html>
